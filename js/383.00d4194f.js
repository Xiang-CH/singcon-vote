"use strict";(self["webpackChunkcssaud_singcon"]=self["webpackChunkcssaud_singcon"]||[]).push([[383],{1383:function(e,t,a){a.r(t),a.d(t,{default:function(){return w}});var l=a(3396),o=a(7139),s=a(9242);const r=(0,l._)("h3",{class:"mb-10"},"后台登陆",-1),i=(0,l._)("br",null,null,-1),n={key:1},d={key:0},c={key:1};function h(e,t,a,h,u,m){const p=(0,l.up)("v-alert"),g=(0,l.up)("v-text-field"),f=(0,l.up)("v-btn"),k=(0,l.up)("v-form"),_=(0,l.up)("v-card"),w=(0,l.up)("StreamBarcodeReader");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l.Wm)(p,{class:(0,o.C_)("alert mt-3 "+(u.alert?"":"d-none")),color:"warning",density:"compact",text:u.alert_text},null,8,["class","text"]),u.loggedin?((0,l.wg)(),(0,l.iD)("div",n,[u.checkInMode?((0,l.wg)(),(0,l.iD)("div",d,[u.isWechat?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(w,{key:0,style:{"margin-left":"auto","margin-right":"auto"},class:(0,o.C_)("qr "+(u.alert?"mt-3":"mt-16")),onDecode:m.onDecode},null,8,["class","onDecode"])),(0,l.Wm)(f,{class:"mt-8",onClick:t[3]||(t[3]=()=>{this.checkInMode=!1,this.alert=!1}),size:"large",color:"secondary"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 管理模式 ")])),_:1})])):((0,l.wg)(),(0,l.iD)("div",c,[(0,l.Wm)(f,{class:"mt-8",onClick:t[4]||(t[4]=()=>{m.checkIfWechat()}),size:"large",color:"primary"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 签票模式 ")])),_:1})]))])):((0,l.wg)(),(0,l.j4)(_,{key:0,class:(0,o.C_)("mx-auto w-75 px-6 py-8 bg-grey-lighten-5 "+(u.alert?"mt-5":"mt-16")),"max-width":"344"},{default:(0,l.w5)((()=>[r,(0,l.Wm)(k,{modelValue:u.form,"onUpdate:modelValue":t[2]||(t[2]=e=>u.form=e),onSubmit:(0,s.iM)(m.onSubmit,["prevent"])},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{modelValue:u.username,"onUpdate:modelValue":t[0]||(t[0]=e=>u.username=e),readonly:u.loading,rules:[m.required],class:"mb-2",clearable:"",label:"Staff 用户名"},null,8,["modelValue","readonly","rules"]),(0,l.Wm)(g,{modelValue:u.password,"onUpdate:modelValue":t[1]||(t[1]=e=>u.password=e),type:"password",readonly:u.loading,rules:[m.required],clearable:"",label:"Staff 密码",placeholder:"Enter your password"},null,8,["modelValue","readonly","rules"]),i,(0,l.Wm)(f,{disabled:!u.form,loading:u.loading,block:"",color:"primary",size:"large",type:"submit",variant:"elevated"},{default:(0,l.w5)((()=>[(0,l.Uk)(" 登陆 ")])),_:1},8,["disabled","loading"])])),_:1},8,["modelValue","onSubmit"])])),_:1},8,["class"]))],64)}var u=a(4161),m=a(9028),p=a.n(m),g=a(4411),f={components:{StreamBarcodeReader:g.w},data(){return{loggedin:!1,form:!1,username:null,password:null,loading:!1,alert:!1,alert_text:"登陆失败请重试",token:null,checkInMode:!1,isWechat:!1}},methods:{onDecode(e){console.log(`Decode text from QR code is ${e}`);const t=decodeURI(e).split("=")[0],a=decodeURI(e).split("=")[1];if("https://v.6re.co?k"!=t)return this.alert_text="无效的二维码",this.alert=!0,void setTimeout((()=>{this.alert=!1}),1e3);u.Z.post("https://api.singcon23.hkupootal.com/admin/checkin.php",{token:this.token,user_key:a},{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{"200"==e.data.code?(this.alert_text="签到成功",this.alert=!0,setTimeout((()=>{this.alert=!1}),1e3)):"400"==e.data.code?(this.alert_text="无效票",this.alert=!0,setTimeout((()=>{this.alert=!1}),1e3)):"401"==e.data.code?(this.alert_text="已入场",this.alert=!0,setTimeout((()=>{this.alert=!1}),1e3)):"500"==e.data.code?(this.alert_text="签到失败",this.alert=!0,setTimeout((()=>{this.alert=!1}),1e3)):(this.alert_text="staff登陆过期, 刷新网页重新登陆",this.alert=!0)})).catch((e=>{console.log(e),this.alert_text="签到失败",this.alert=!0,setTimeout((()=>{this.alert=!1}),1e3)}))},configWechat(){return new Promise(((e,t)=>{alert(location.href),u.Z.post("https://api.singcon23.hkupootal.com/wechat/sign.php",{url:location.href.split("#")[0]},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{200==a.status?(p().config({debug:!0,appId:a.data.appId,timestamp:a.data.timestamp,nonceStr:a.data.nonceStr,signature:a.data.signature,jsApiList:a.data.jsApiList}),e()):(this.alert_text="微信签名失败, 尝试重新打开",this.alert=!0,t())})).catch((e=>{console.log(e),this.alert_text="微信签名失败, 尝试重新打开",this.alert=!0,t()}))}))},checkIfWechat(){this.checkInMode=!0,/MicroMessenger/i.test(window.navigator.userAgent)&&(this.isWechat=!0,this.configWechat().then((()=>{p().ready((()=>{console.log("WXready")})),p().error((()=>{console.log("WXerror")}))})))},onSubmit(){this.form&&(this.loading=!0,u.Z.post("https://api.singcon23.hkupootal.com/admin/login.php",{admin_name:this.username,admin_password:this.password},{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{this.loading=!1,"200"==e.data.code?(this.loggedin=!0,this.token=e.data.token):"400"==e.data.code?(this.alert_text="用户名或密码错误",this.alert=!0,setTimeout((()=>{this.alert=!1}),5e3)):(this.alert_text="登陆失败请重试",this.alert=!0,setTimeout((()=>{this.alert=!1}),5e3))})).catch((()=>{this.loading=!1,this.alert_text="登陆失败请重试",this.alert=!0,setTimeout((()=>{this.alert=!1}),5e3)})))},required(e){return!!e||"必填项"}}},k=a(89);const _=(0,k.Z)(f,[["render",h]]);var w=_}}]);
//# sourceMappingURL=383.00d4194f.js.map