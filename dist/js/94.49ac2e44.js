"use strict";(self["webpackChunkcssaud_singcon"]=self["webpackChunkcssaud_singcon"]||[]).push([[94],{9094:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var s=a(3396),i=a(7139);const o=t=>((0,s.dD)("data-v-78bc4889"),t=t(),(0,s.Cn)(),t),l={key:0,src:"/loading.gif",class:"loading"},n={key:0},d={key:0},u={key:1},r={key:1},c={key:1},p=o((()=>(0,s._)("br",null,null,-1)));function h(t,e,a,o,h,m){const v=(0,s.up)("v-tab"),_=(0,s.up)("v-tabs"),g=(0,s.up)("v-card"),w=(0,s.up)("v-list-item"),f=(0,s.up)("v-list"),x=(0,s.up)("v-window-item"),k=(0,s.up)("v-alert"),y=(0,s.up)("v-btn"),b=(0,s.up)("v-card-title"),W=(0,s.up)("v-card-text"),D=(0,s.up)("v-window");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(g,{class:"mb-2",color:"primary",rounded:"0"},{default:(0,s.w5)((()=>[(0,s.Wm)(_,{modelValue:h.tab,"onUpdate:modelValue":e[2]||(e[2]=t=>h.tab=t),"bg-color":"primary","fixed-tabs":"",density:"compact"},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{value:"history",onClick:e[0]||(e[0]=t=>m.getPast())},{default:(0,s.w5)((()=>[(0,s.Uk)("历史")])),_:1}),(0,s.Wm)(v,{value:"vote",onClick:e[1]||(e[1]=t=>m.getNow())},{default:(0,s.w5)((()=>[(0,s.Uk)("投票")])),_:1})])),_:1},8,["modelValue"])])),_:1}),h.loading?((0,s.wg)(),(0,s.iD)("img",l)):(0,s.kq)("",!0),(0,s.Wm)(D,{modelValue:h.tab,"onUpdate:modelValue":e[4]||(e[4]=t=>h.tab=t)},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{value:"history"},{default:(0,s.w5)((()=>[(0,s.Wm)(g,{class:"mx-auto w-75 py-2 px-2 mt-4 mb-2","max-width":"400",title:h.round,subtitle:"已投选手",rounded:"xl",variant:"elevated"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{lines:"two",class:"mx-2",nav:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.options,((t,e)=>((0,s.wg)(),(0,s.j4)(w,{variant:"flat",style:{"text-align":"left","font-size":"15px"},key:e,title:t.singer_info.singer_name,subtitle:t.song_name,"prepend-avatar":t.singer_info.singer_photo,rounded:"xl",class:"inactive"},null,8,["title","subtitle","prepend-avatar"])))),128))])),_:1})])),_:1},8,["title"])])),_:1}),(0,s.Wm)(x,{value:"vote"},{default:(0,s.w5)((()=>["open"==h.vote_status?((0,s.wg)(),(0,s.iD)("div",n,[h.voted?((0,s.wg)(),(0,s.iD)("div",d,[(0,s.Wm)(g,{class:"mx-auto w-75 py-2 px-2 mt-4 mb-2","max-width":"400",title:h.round,subtitle:"已投选手",rounded:"xl",variant:"elevated"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{lines:"two",class:"mx-2",nav:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.options,((t,e)=>((0,s.wg)(),(0,s.j4)(w,{variant:"flat",style:{"text-align":"left","font-size":"15px"},key:e,title:t.singer_info.singer_name,subtitle:t.song_name,"prepend-avatar":t.singer_info.singer_photo,rounded:"xl",class:"inactive"},null,8,["title","subtitle","prepend-avatar"])))),128))])),_:1})])),_:1},8,["title"])])):((0,s.wg)(),(0,s.iD)("div",u,[(0,s.Wm)(g,{title:h.timer,variant:"flat",rounded:"xl",style:{height:"50px"},class:"mx-auto w-75 py-0 px-2 mb-2"},null,8,["title"]),(0,s.Wm)(k,{class:(0,i.C_)("mb-2 w-75 mx-auto "+(h.alert?"":"d-none")),color:"warning",density:"compact",text:"请选择 "+h.max_select+" 名选手!",rounded:"xl"},null,8,["class","text"]),(0,s.Wm)(g,{class:"mx-auto w-75 py-2 px-2","max-width":"400",title:h.round,rounded:"xl",variant:"elevated"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{lines:"two",class:"mx-2",nav:""},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(h.options,((t,e)=>((0,s.wg)(),(0,s.j4)(w,{variant:"flat",style:{"text-align":"left","font-size":"15px"},key:e,value:t.singer_id,title:t.singer_info.singer_name,subtitle:t.song_name,"prepend-avatar":t.singer_info.singer_photo,rounded:"xl",class:(0,i.C_)(h.chosen.indexOf(t.option_id)>-1?"active":"inactive"),onClick:e=>m.toggleActive(t.option_id),disabled:h.chosen.length>=h.max_select&&h.chosen.indexOf(t.option_id)<0},null,8,["value","title","subtitle","prepend-avatar","class","onClick","disabled"])))),128))])),_:1})])),_:1},8,["title"]),(0,s.Wm)(y,{style:{width:"30vw"},class:"mt-8 mb-2",onClick:e[3]||(e[3]=t=>m.submit()),size:"large",color:"primary",rounded:"xl"},{default:(0,s.w5)((()=>[(0,s.Uk)("确认")])),_:1})]))])):((0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(g,{variant:"flat",class:"w-75 mx-auto mt-16"},{default:(0,s.w5)((()=>["end"==h.vote_status?((0,s.wg)(),(0,s.j4)(b,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)("投票已结束")])),_:1})):(0,s.kq)("",!0),"pending"==h.vote_status?((0,s.wg)(),(0,s.iD)("div",c,[(0,s.Wm)(b,{style:{"font-size":"28px","margin-bottom":"15px"}},{default:(0,s.w5)((()=>[(0,s.Uk)("投票未开始")])),_:1}),(0,s.Wm)(W,{style:{"text-align":"center"}},{default:(0,s.w5)((()=>[(0,s.Uk)("请在投票开始时"),p,(0,s.Uk)("刷新本页或重新扫描票面二维码")])),_:1})])):(0,s.kq)("",!0)])),_:1})]))])),_:1})])),_:1},8,["modelValue"])],64)}a(7658);var m=a(4161),v={data(){return{loading:!0,key:null,round:"",options:null,chosen:[],max_select:1,alert:!1,tab:"vote",voted:!0,vote_id:null,vote_status:null,timer:null,endTime:null,pastVote:null}},computed:{},methods:{vote(t){this.votes[t]++},startTimer(){const t=(new Date).getTime(),e=this.endTime-t,a=1e3,s=60*a,i=60*s,o=e%i/s,l=e%s/a,n=Math.floor(o),d=Math.floor(l);n<=0&&d<=0?(this.timer="投票结束",setTimeout((()=>{this.$router.push("/vote/"+this.key)}),1e3)):this.timer=n<=0?"剩余时间:"+d+" 秒":"剩余时间: "+n+" 分 "+d+" 秒"},toggleActive(t){this.chosen.indexOf(t)>-1?this.chosen.splice(this.chosen.indexOf(t),1):this.chosen.length<this.max_select&&this.chosen.push(t),console.log(this.chosen)},submit(){if(console.log(this.chosen),this.chosen.length<this.max_select)this.alert=!0,setTimeout((()=>{this.alert=!1}),2e3);else{this.alert=!1,this.voted=!0;var t=[this.options[parseInt(this.chosen[0])-1],this.options[parseInt(this.chosen[1])-1],this.options[parseInt(this.chosen[2])-1]];this.options=t}},getNow(){this.loading=!0,console.log(this.$router),this.key=this.$router.currentRoute.value.params.user_key,m.Z.post("https://api.singcon23.hkupootal.com/vote/getnow.php",{user_key:this.$router.currentRoute.value.params.user_key},{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{this.loading=!1,200==t.data.code?(this.vote_id=t.data.vote_detail.vote_id,this.voted=t.data.vote_detail.is_voted,this.max_select=t.data.vote_detail.vote_select_count,this.vote_status=t.data.vote_detail.vote_status,this.round=t.data.vote_detail.vote_title,this.options=t.data.vote_detail.option_list,this.endTime=new Date("Apr 11, 23 01:59:40 GMT+08:00"),"open"==t.data.vote_detail.vote_status&&0==t.data.vote_detail.is_voted&&setInterval((()=>{this.startTimer()}),1e3)):201==t.data.code?this.vote_status="pending":(alert("投票信息获取时报，请重新扫描"),this.$router.push("/home"))})).catch((t=>{this.loading=!1,console.log(t),alert("投票信息获取失败，请重新扫描")}))},getPast(){m.Z.post("https://api.singcon23.hkupootal.com/vote/getpast.php",{user_key:this.key},{headers:{"Content-Type":"mulipart/form-data"}}).then((t=>{200==t.data.code&&(this.pastVote=t.data.vote_list)}))}},mounted(){this.getNow()}},_=a(89);const g=(0,_.Z)(v,[["render",h],["__scopeId","data-v-78bc4889"]]);var w=g}}]);
//# sourceMappingURL=94.49ac2e44.js.map