{"version":3,"file":"js/383.00d4194f.js","mappings":"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","sources":["webpack://cssaud-singcon/./src/views/AdminPage.vue","webpack://cssaud-singcon/./src/views/AdminPage.vue?c533"],"sourcesContent":["<template>\n\n        <v-alert \n            :class= \"'alert mt-3 '+ (alert? '' : 'd-none') \"\n            color=\"warning\"\n            density=\"compact\"\n            :text = \"alert_text\"\n        ></v-alert>\n\n        <v-card \n            :class=\"'mx-auto w-75 px-6 py-8 bg-grey-lighten-5 ' + (alert? 'mt-5': 'mt-16')\" \n            max-width=\"344\"\n            v-if = \"!loggedin\"\n        >\n            <h3 class=\"mb-10\">后台登陆</h3>\n            <v-form\n            v-model=\"form\"\n            @submit.prevent=\"onSubmit\"\n            >\n            <v-text-field\n                v-model=\"username\"\n                :readonly=\"loading\"\n                :rules=\"[required]\"\n                class=\"mb-2\"\n                clearable\n                label=\"Staff 用户名\"\n            ></v-text-field>\n    \n            <v-text-field\n                v-model=\"password\"\n                type=\"password\"\n                :readonly=\"loading\"\n                :rules=\"[required]\"\n                clearable\n                label=\"Staff 密码\"\n                placeholder=\"Enter your password\"\n            ></v-text-field>\n    \n            <br>\n    \n            <v-btn\n                :disabled=\"!form\"\n                :loading=\"loading\"\n                block\n                color=\"primary\"\n                size=\"large\"\n                type=\"submit\"\n                variant=\"elevated\"\n            >\n                登陆\n            </v-btn>\n            </v-form>\n        </v-card>\n\n        <div v-else>\n\n            <div v-if=\"checkInMode\">\n                <StreamBarcodeReader\n                    style=\"margin-left: auto; margin-right: auto;\"\n                    v-if = \"!isWechat\"\n                    :class=\"'qr '+(alert? 'mt-3': 'mt-16')\" \n                    @decode=\"onDecode\"\n                ></StreamBarcodeReader>\n                <v-btn\n                    class=\"mt-8\"\n                    @click=\"() => {this.checkInMode = false; this.alert = false}\"\n                    size=\"large\"\n                    color=\"secondary\"\n                >\n                    管理模式\n                </v-btn>\n            </div>\n\n            <div v-else>\n                <v-btn\n                    class=\"mt-8\"\n                    @click=\"() => {checkIfWechat()}\"\n                    size=\"large\"\n                    color=\"primary\"\n                >\n                    签票模式\n                </v-btn>\n            </div>\n            \n        </div>\n\n\n\n\n\n</template>\n\n<script>\n    import axios from 'axios'\n    import wx from 'weixin-js-sdk'\n    import { StreamBarcodeReader } from \"vue-barcode-reader\";\n\n    export default{\n        components: {\n            StreamBarcodeReader\n        },\n\n        data(){\n            return{\n                loggedin : false,\n                form: false,\n                username: null,\n                password: null,\n                loading: false,\n                alert: false,\n                alert_text: \"登陆失败请重试\",\n                token: null,\n                checkInMode: false,\n                isWechat: false,\n            }\n        },\n\n\n        methods: {\n            onDecode(text) {\n                console.log(`Decode text from QR code is ${text}`)\n                const domain = decodeURI(text).split('=')[0];\n                const key = decodeURI(text).split('=')[1];\n                if (domain != 'https://v.6re.co?k'){\n                    this.alert_text = \"无效的二维码\"\n                    this.alert = true;\n                    setTimeout(() => {\n                        this.alert = false;\n                    }, 1000);\n                    return\n                }\n                axios.post(\"https://api.singcon23.hkupootal.com/admin/checkin.php\",{\n                    token: this.token,\n                    user_key: key\n                }, {\n                    headers: {\n                        'Content-Type': 'multipart/form-data'\n                    }\n                })\n                .then(\n                    (res) => {\n                        if(res.data.code == \"200\"){\n                            this.alert_text = \"签到成功\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 1000);\n                        }else if (res.data.code == \"400\"){\n                            this.alert_text = \"无效票\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 1000);\n                        }else if (res.data.code == \"401\"){\n                            this.alert_text = \"已入场\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 1000);\n                        }else if (res.data.code == \"500\"){\n                            this.alert_text = \"签到失败\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 1000);\n                        }else{\n                            this.alert_text = \"staff登陆过期, 刷新网页重新登陆\"\n                            this.alert = true;\n                        }\n                    }\n                ).catch(\n                    (err) => {\n                        console.log(err)\n                        this.alert_text = \"签到失败\"\n                        this.alert = true;\n                        setTimeout(() => {\n                            this.alert = false;\n                        }, 1000);\n                    }\n                )\n                \n            },\n\n            configWechat(){\n                return new Promise ((resolve, reject) => {\n                    alert(location.href)\n                    axios.post(\"https://api.singcon23.hkupootal.com/wechat/sign.php\", \n                    {url: location.href.split('#')[0]}, \n                    {\n                        headers: {\n                            'Content-Type': 'multipart/form-data'\n                        }\n                    })\n                    .then(\n                        res => {\n                            if(res.status == 200){\n                                wx.config({\n                                    debug: true,\n                                    appId: res.data.appId,\n                                    timestamp: res.data.timestamp,\n                                    nonceStr: res.data.nonceStr,\n                                    signature: res.data.signature,\n                                    jsApiList: res.data.jsApiList\n                                })\n                                resolve()\n                            }else{\n                                this.alert_text = \"微信签名失败, 尝试重新打开\"\n                                this.alert = true;\n                                reject()\n                            }\n                        }\n                    ).catch(\n                        (err) => {\n                            console.log(err)\n                            this.alert_text = \"微信签名失败, 尝试重新打开\"\n                            this.alert = true;\n                            reject()\n                        }\n                    )\n                })\n            },\n\n            checkIfWechat(){\n                this.checkInMode = true\n                //检查微信环境\n                if (/MicroMessenger/i.test(window.navigator.userAgent)){\n                    this.isWechat=true;\n                    this.configWechat().then(\n                        () => {\n                            wx.ready( () => {\n                                console.log(\"WXready\")\n                            })\n\n                            wx.error( () => {\n                                console.log(\"WXerror\")\n                            })\n                        }\n\n                    )\n                }\n            },\n            onSubmit () {\n                if (!this.form) return\n\n                this.loading = true\n\n                axios.post('https://api.singcon23.hkupootal.com/admin/login.php', {\n                    admin_name: this.username,\n                    admin_password: this.password\n                }, {\n                    headers: {\n                        'Content-Type': 'multipart/form-data'\n                    }\n                })\n                .then(\n                    (res) => {\n                        this.loading = false\n                        if(res.data.code == \"200\"){\n                            this.loggedin = true;\n                            this.token = res.data.token;\n                        }\n                        else if(res.data.code == \"400\"){\n                            this.alert_text = \"用户名或密码错误\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 5000);\n                        }\n                        else{\n                            this.alert_text = \"登陆失败请重试\"\n                            this.alert = true;\n                            setTimeout(() => {\n                                this.alert = false;\n                            }, 5000);\n                        }\n                    }\n                ).catch(() => {\n                    this.loading = false\n                    this.alert_text = \"登陆失败请重试\"\n                    this.alert = true;\n                    setTimeout(() => {\n                        this.alert = false;\n                    }, 5000);\n                })\n\n            },\n\n            required (v) {\n                return !!v || '必填项'\n            },\n        }\n        \n    }\n</script>\n\n<style>\n\n</style>","import { render } from \"./AdminPage.vue?vue&type=template&id=74a3d5ab\"\nimport script from \"./AdminPage.vue?vue&type=script&lang=js\"\nexport * from \"./AdminPage.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/chenxiang/Projects/HKU_Pootal/singcon-vote/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","_createVNode","_component_v_alert","_normalizeClass","$data","alert","color","density","text","alert_text","loggedin","_createElementBlock","_hoisted_3","checkInMode","_hoisted_4","isWechat","_createBlock","_component_StreamBarcodeReader","style","onDecode","$options","_component_v_btn","onClick","_cache","size","_hoisted_5","checkIfWechat","_component_v_card","_hoisted_1","_component_v_form","form","$event","onSubmit","_withModifiers","_component_v_text_field","username","readonly","loading","rules","required","clearable","label","password","type","placeholder","_hoisted_2","disabled","block","variant","components","StreamBarcodeReader","data","token","methods","console","log","domain","decodeURI","split","key","this","setTimeout","axios","user_key","headers","then","res","code","catch","err","configWechat","Promise","resolve","reject","location","href","url","status","wx","debug","appId","timestamp","nonceStr","signature","jsApiList","test","window","navigator","userAgent","admin_name","admin_password","v","__exports__","render"],"sourceRoot":""}