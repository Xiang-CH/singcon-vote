{"version":3,"file":"js/368.7df43c81.js","mappings":"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","sources":["webpack://cssaud-singcon/./src/views/TicketPage.vue","webpack://cssaud-singcon/./src/views/TicketPage.vue?180d"],"sourcesContent":["<template>\n\n    <v-alert \n            v-if = \"alert\"\n            class= \"mt-10 alert\"\n            color=\"warning\"\n            density=\"compact\"\n            :text = \"alert_text\"\n    ></v-alert>\n\n    <div v-if=\"loaded\">\n            <h2 style=\"margin-top: 15vh; margin-bottom: 20px;\">扫描成功</h2>\n            <div class=\"wechatPrompt\">\n                <h3>前往微信扫描打开</h3>\n                <h3>可获取噗噗纪念头像奖励</h3>\n            </div>\n            <!-- <v-btn\n                color=\"primary w-75 mx-auto my-3\"\n                @click=\"verifyInWechat()\"\n            >跳转至微信打开</v-btn> -->\n            <v-btn\n                color=\"grey w-50 mx-auto my-3\"\n                @click=\"verifyRefused()\"\n            >直接打开</v-btn>\n            <v-overlay\n                v-model=\"overlay\"\n                contained\n                class=\"align-center justify-center\"\n            >\n                \n                <img src=\"loading.gif\"/>\n            </v-overlay>\n    </div>\n\n    <StaffBtn/>\n   \n\n\n</template>\n\n<script>\nimport axios from 'axios';\nimport StaffBtn from '../components/StaffBtn.vue';\nvar wx = require('weixin-js-sdk');\n\nexport default{\n    components: {\n        StaffBtn\n    },\n    data(){\n        return{\n            loaded :false,\n            alert: false,\n            alert_text: '扫描失败请重试',\n            key: \"\",\n            overlay: true,\n        }\n    },\n    methods:{\n        verifyInWechat(){\n            wx.setStorageSync('user_key', this.key)\n            this.overlay = true;\n            //const url = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx91a4ad470fb0b432&redirect_uri=https%3A%2F%2Fone.hkupootal.com%3Furl%3Dhttps%253A%252F%252Fsingcon23.hkupootal.com%252Fwechat&response_type=code&scope=snsapi_base#wechat_redirect\";\n            const url = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx91a4ad470fb0b432&redirect_uri=https%3A%2F%2Fone.hkupootal.com%3Furl%3Dhttps%253A%252F%252Fsingcon23.hkupootal.com%252Fwechat&response_type=code&scope=snsapi_base#wechat_redirect\";\n            window.location.href = url;\n        },\n\n        verifyRefused(){\n            this.overlay = true;\n            axios.post('https://api.singcon23.hkupootal.com/user/refuse.php', {\n                user_key: this.key\n            }  , {\n                headers: {\n                    'Content-Type': 'multipart/form-data'\n                }\n            })\n            .then(\n                (res) => {\n                    console.log(res.data)\n                    this.overlay = false;\n                    if (res.data.code == '200'){\n                        this.$router.push({ name: 'vote', params: {user_key: this.key} });\n                    }\n                    else if(res.data.code == '400'){\n                        this.loaded = false\n                        this.alert_text='无效票，请尝试新扫描'\n                        this.alert = true;\n                    }\n                    else if(res.data.code == '401'){\n                        this.loaded = false\n                        this.alert_text='为入场，请先入场签到'\n                        this.alert = true;\n                    }else{\n                        this.loaded = false\n                        this.alert_text='验证失败请重试'\n                        this.alert = true;\n                        setTimeout(() => {\n                            this.loaded = true;\n                        }, 2000);\n                    }\n                }\n            )\n            .catch(\n                (err) => {\n                    console.log(err)\n                    this.overlay = false;\n                    this.loaded = false\n                    this.alert_text='验证失败请重试'\n                    this.alert = true;\n                    setTimeout(() => {\n                        this.loaded = true;\n                    }, 2000);\n                }\n            )\n        },\n\n        \n    },\n    mounted(){\n            console.log(\"mounted\")\n            const key = this.$router.currentRoute.value.query.k\n            console.log(key)\n            this.key = key\n            axios\n                .post('https://api.singcon23.hkupootal.com/user/check.php', {\n                    user_key: key\n                }  , {\n                    headers: {\n                        'Content-Type': 'multipart/form-data'\n                    }\n                })\n                .then(\n                    response => {\n                        console.log(response.data);\n                        this.overlay=false;\n                        if (response.data.code == '200'){\n                            console.log(\"not binded or refused\")\n                            //检查微信环境\n                            if (/MicroMessenger/i.test(window.navigator.userAgent)){\n                                console.log(\"wechat\")\n                                this.verifyInWechat()\n                            }\n                            else{\n                                this.loaded = true\n                            }\n                        }\n                        else if (response.data.code == '201' || response.data.code == '202'){\n                            this.$router.push({ name: 'vote', params: {user_key: key} });\n                        }\n                        else if (response.data.code == '401'){\n                            console.log(\"haven't checked in\")\n                            this.alert_text='未入场，请先入场签到。'\n                            this.alert = true;\n                        }\n                        else{\n                            console.log(\"invalid try again\")\n                            this.alert_text='扫描失败请重试'\n                            this.alert = true;\n                        }\n                    }\n                )\n                .catch(error => {\n                    console.log(error);\n                    this.overlay=false;\n                    this.alert_text = '扫描失败请重试'\n                    this.alert = true;\n                });\n        }\n}\n</script>\n\n\n<style>\n.ticketPageContainer{\n   position: relative\n}\n.wechatPrompt{\n    color: #104e8d;\n    margin-top: 60px;\n    margin-bottom: 30px;\n    text-align: center;\n}\n</style>","import { render } from \"./TicketPage.vue?vue&type=template&id=35f6193b\"\nimport script from \"./TicketPage.vue?vue&type=script&lang=js\"\nexport * from \"./TicketPage.vue?vue&type=script&lang=js\"\n\nimport \"./TicketPage.vue?vue&type=style&index=0&id=35f6193b&lang=css\"\n\nimport exportComponent from \"/Users/chenxiang/Projects/HKU_Pootal/singcon-vote/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","style","class","src","$data","alert","_createBlock","_component_v_alert","color","density","text","alert_text","loaded","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_createVNode","_component_v_btn","onClick","_cache","$event","$options","verifyRefused","_component_v_overlay","overlay","contained","_hoisted_4","_component_StaffBtn","wx","require","components","StaffBtn","data","key","methods","verifyInWechat","setStorageSync","this","url","window","location","href","axios","user_key","headers","then","res","console","log","code","$router","push","name","params","setTimeout","catch","err","mounted","currentRoute","value","query","k","response","test","navigator","userAgent","error","__exports__","render"],"sourceRoot":""}